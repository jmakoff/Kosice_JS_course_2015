<!DOCTYPE html>
<html>
    <head>
        <title>HW1 test</title>
        <script src="Basket.js" type="text/javascript"></script>
    </head>
    <body>
        <h1> Test for homework 1 </h1>
        <h3> Inventory: </h3>
        <table id ="inventoryTable">
        </table>
        <script >
            var products;
            if (products === undefined) {
                products = prodcuts;
            }
            function refreshInventoryTable() {
                console.log("refreshInventoryTable");
                //var body = document.getElementsByTagName('body')[0];
                //var tbl = document.createElement('table');
                //tbl.setAttribute('border', '1');
                var tbdy = document.createElement('tbody');
                var tr = document.createElement('tr');
                var th1 = document.createElement('th');
                th1.appendChild(document.createTextNode('name'));
                var th2 = document.createElement('th');
                th2.appendChild(document.createTextNode('price'));
                var th3 = document.createElement('th');
                th3.appendChild(document.createTextNode('inventory'));
                tr.appendChild(th1);
                tr.appendChild(th2);
                tr.appendChild(th3);
                tbdy.appendChild(tr);
                for (var i = 0; i < products.length; i++) {
                    var tr = document.createElement('tr');
                    var td1 = document.createElement('td');
                    td1.appendChild(document.createTextNode(products[i].name));
                    var td2 = document.createElement('td');
                    td2.appendChild(document.createTextNode(products[i].price));
                    var td3 = document.createElement('td');
                    td3.appendChild(document.createTextNode(products[i].inventory));
                    tr.appendChild(td1);
                    tr.appendChild(td2);
                    tr.appendChild(td3);
                    tbdy.appendChild(tr);
                }
                var table = document.getElementById('inventoryTable');
                table.innerHTML = tbdy.innerHTML;
                //tbl.appendChild(tbdy);
                //body.appendChild(tbl)
            }
            refreshInventoryTable();

            function getProductQuantity(productID) {
                console.log("getProductQuantity: ");
                console.log("basket items size: " + basket.getItems().length);
                for (var i = 0; i < basket.getItems().length; i++) {
                    var items = basket.getItems();
                    if (items === undefined) {
                        console.log("basket items undefined: ");
                        return 0;
                    }
                    //
                    if (items[i].productID === productID) {
                        console.log("item: [" + items[i].toString() + "]");
                        return items[i].quantity;
                    }
                }
                return 0;
            }

            function refreshBasketTable() {
                refreshInventoryTable();
                console.log("refreshBasketTable");
                //var body = document.getElementsByTagName('body')[0];
//                var tbl = document.createElement('table');
//                tbl.setAttribute('border', '1');
                var tbdy = document.createElement('tbody');
                var tr = document.createElement('tr');
                var th1 = document.createElement('th');
                th1.appendChild(document.createTextNode('name'));
                var th2 = document.createElement('th');
                th2.appendChild(document.createTextNode('quantity'));
                var th3 = document.createElement('th');
                th3.appendChild(document.createTextNode('price'));
                tr.appendChild(th1);
                tr.appendChild(th2);
                tr.appendChild(th3);
                tbdy.appendChild(tr);
                for (var i = 0; i < products.length; i++) {
                    var tr = document.createElement('tr');
                    var td1 = document.createElement('td');
                    td1.appendChild(document.createTextNode(products[i].name));
                    var td2 = document.createElement('td');
                    var quantity = getProductQuantity(i);
                    td2.appendChild(document.createTextNode(quantity));
                    var td3 = document.createElement('td');
                    td3.appendChild(document.createTextNode(quantity * products[i].price));
                    tr.appendChild(td1);
                    tr.appendChild(td2);
                    tr.appendChild(td3);
                    tbdy.appendChild(tr);
                }
                var table = document.getElementById('basketTable');
                table.innerHTML = tbdy.innerHTML;
                //table.appendChild(tbdy);
                //body.appendChild(table)
                var priceParagraph = document.getElementById('totalPriceParagraph');
                priceParagraph.innerHTML = (document.createTextNode("Total price is: " + basket.getTotalPrice() + ".")).wholeText;
            }
            //tableBasketCreate();
        </script>

        <h3>Actions:</h3>
        <script>
            function tableButtonsCreate() {
                var body = document.getElementsByTagName('body')[0];
                var tbl = document.createElement('table');
                tbl.setAttribute('border', '1');
                var tbdy = document.createElement('tbody');
                var headings = ["addProduct:", "removeProduct:", "TODO: updateQuantity:"];
                for (var j = 0; j < 3; j++) {
                    var tr = document.createElement('tr');
                    var td = document.createElement('td');
                    td.appendChild(document.createTextNode(headings[j]));
                    tr.appendChild(td);
                    for (var i = 0; i < products.length; i++) {
                        var button = document.createElement('button');
                        if (j === 0) {
                            button.appendChild(document.createTextNode("add " + products[i].name));
                            button.setAttribute("onClick", "basket.addProduct(" + i + ")");
                        }
                        if (j === 1) {
                            button.appendChild(document.createTextNode("remove " + products[i].name));
                            button.setAttribute("onClick", "basket.removeProduct(" + i + ")");
                        }
                        if (j === 2) {
                            var x = document.createElement("INPUT");
                            x.setAttribute("type", "text");
                            x.setAttribute("size", "2");
                            x.setAttribute("id", "input" + products[i].name);
                            x.setAttribute("value", "1");
                            tr.appendChild(x);
                            button.appendChild(document.createTextNode("update " + products[i].name));
                            // TODO: make possible updating different number than 1        
                            button.setAttribute("onClick", "basket.updateProductQuantity(" + i + ",1)");
                        }
                        tr.appendChild(button);
                    }
                    tbdy.appendChild(tr);
                }
                tbl.appendChild(tbdy);
                body.appendChild(tbl)
            }

            tableButtonsCreate();
        </script>
        <h3>Basket:</h3>
        <table id ="basketTable">
        </table>
        <p id="totalPriceParagraph">Total price is: 0.</p>
    </body>
</html>
